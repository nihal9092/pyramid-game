<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Pyramid - Elite Social Hierarchy</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey:            "AIzaSyBs81OlYrQ1_HBUHJ3Tim1vT-2glHOZPbc",
      authDomain:        "pyramidgame2026.firebasestorage.app",
      projectId:         "pyramidgame2026",
      storageBucket:     "pyramidgame2026.firebaseapp.com",
      messagingSenderId: "302574478188",
      appId:             "1:302574478188:web:aded8d66bdd1f828da8949"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;500;600;700;800&display=swap");

    :root {
      --primary-gold:#ffd700;
      --secondary-gold:#ffa500;
      --accent-purple:#9333ea;
      --accent-pink:#ec4899;
      --accent-cyan:#06b6d4;
    }
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: linear-gradient(135deg, #0a0a0f 0%, #1a0a2e 50%, #0a0a0f 100%);
      background-attachment: fixed;
      color: #e5e5e5;
      font-family: "Inter", sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }
    .cinzel { font-family: "Cinzel", serif; }

    /* Animated BG */
    .bg-animate {
      position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none;
      background:
        radial-gradient(circle at 20% 50%, rgba(147,51,234,.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(236,72,153,.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(6,182,212,.05) 0%, transparent 50%);
      z-index: 0;
      animation: bgShift 20s ease-in-out infinite;
    }
    @keyframes bgShift { 0%,100%{opacity:.3} 50%{opacity:.6} }

    /* Glass card */
    .glass-card {
      background: rgba(26,26,36,.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,.1);
      box-shadow: 0 8px 32px rgba(31,38,135,.37), inset 0 1px 0 rgba(255,255,255,.1);
      transition: border-color .3s, box-shadow .3s, transform .3s;
    }
    .glass-card:hover {
      border-color: rgba(255,215,0,.3);
      box-shadow: 0 12px 40px rgba(255,215,0,.2), inset 0 1px 0 rgba(255,255,255,.15);
      transform: translateY(-2px);
    }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold), var(--accent-pink));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .gradient-text-purple {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }

    /* Title badges */
    .title-badge {
      display:inline-block; padding:4px 12px; border-radius:20px;
      font-size:10px; font-weight:700; text-transform:uppercase;
      letter-spacing:1px; animation:titleGlow 2s ease-in-out infinite;
    }
    .title-legendary { background:linear-gradient(135deg,#ffd700,#ffa500); color:#000; box-shadow:0 0 20px rgba(255,215,0,.5); }
    .title-epic      { background:linear-gradient(135deg,#9333ea,#ec4899); color:#fff; box-shadow:0 0 20px rgba(147,51,234,.5); }
    .title-rare      { background:linear-gradient(135deg,#06b6d4,#3b82f6); color:#fff; box-shadow:0 0 15px rgba(6,182,212,.4); }
    .title-common    { background:linear-gradient(135deg,#6b7280,#9ca3af); color:#fff; box-shadow:0 0 10px rgba(107,114,128,.3); }
    @keyframes titleGlow { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.2)} }

    /* Rank cards */
    .user-rank-card { position:relative; overflow:hidden; }
    .user-rank-card::before {
      content:""; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);
      transition:left .5s;
    }
    .user-rank-card:hover::before { left:100%; }
    .rank-1 { background:linear-gradient(135deg,rgba(255,215,0,.2),rgba(255,165,0,.1)); border-color:var(--primary-gold)!important; }
    .rank-2 { background:linear-gradient(135deg,rgba(192,192,192,.15),rgba(169,169,169,.1)); border-color:#c0c0c0!important; }
    .rank-3 { background:linear-gradient(135deg,rgba(205,127,50,.15),rgba(184,115,51,.1)); border-color:#cd7f32!important; }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
      color:#000; font-weight:700; padding:12px 24px; border-radius:12px;
      border:none; cursor:pointer; transition:transform .3s, box-shadow .3s;
      text-transform:uppercase; letter-spacing:1px; font-size:14px;
      position:relative; overflow:hidden; display:inline-block; text-align:center;
      font-family:"Cinzel",serif;
    }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(255,215,0,.4); }
    .btn-secondary {
      background:rgba(147,51,234,.2); border:2px solid var(--accent-purple);
      color:var(--accent-purple); font-weight:600; padding:10px 20px;
      border-radius:10px; cursor:pointer; transition:all .3s;
      text-transform:uppercase; font-size:11px; letter-spacing:1px; font-family:inherit;
    }
    .btn-secondary:hover { background:var(--accent-purple); color:#fff; transform:translateY(-1px); box-shadow:0 8px 20px rgba(147,51,234,.4); }
    .btn-gift { background:linear-gradient(135deg,#ec4899,#f97316); border:none; color:#fff; }
    .btn-gift:hover { box-shadow:0 8px 20px rgba(236,72,153,.4); }

    /* ============================================================
       AUTH SCREEN ‚Äî fully self-contained CSS layout
       ============================================================ */
    #auth-screen {
      position:relative; z-index:1;
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:3rem 1rem;
    }
    .auth-grid {
      width:100%; max-width:1100px;
      display:grid; grid-template-columns:1fr 1fr; gap:2rem;
    }
    @media (max-width:720px) { .auth-grid { grid-template-columns:1fr; } }

    .auth-card { padding:2rem; border-radius:1rem; }
    .auth-card-title { font-family:"Cinzel",serif; font-size:1.75rem; font-weight:700; margin-bottom:.4rem; }
    .auth-card-sub { color:#9ca3af; font-size:.85rem; margin-bottom:1.5rem; }

    .auth-field { margin-bottom:.85rem; }
    .auth-row { display:flex; gap:.5rem; }
    .auth-row .auth-input { flex:1; min-width:0; }
    .auth-input-half { width:45%; flex:0 0 45%; }
    .auth-input-quarter { width:22%; flex:0 0 22%; }

    .auth-input {
      width:100%; background:rgba(0,0,0,.4); border:1px solid #3f3f46;
      color:#e2e8f0; padding:.7rem .75rem; font-size:.85rem;
      border-radius:.6rem; font-family:inherit;
      transition:border-color .2s, box-shadow .2s;
    }
    .auth-input::placeholder { color:#52525b; }
    .auth-input:focus { outline:none; border-color:var(--primary-gold); box-shadow:0 0 0 3px rgba(255,215,0,.12); }
    select.auth-input { appearance:auto; }

    .auth-pass-wrap { position:relative; }
    .auth-pass-wrap .auth-input { padding-right:4rem; }
    #toggle-pass {
      position:absolute; right:.65rem; top:50%; transform:translateY(-50%);
      background:none; border:none; color:#71717a; font-size:.7rem;
      font-weight:600; cursor:pointer; transition:color .2s; font-family:inherit;
    }
    #toggle-pass:hover { color:var(--primary-gold); }

    .btn-auth {
      width:100%; padding:.75rem; border-radius:.7rem; border:none;
      background:linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
      color:#000; font-weight:700; font-size:.82rem;
      text-transform:uppercase; letter-spacing:1px; cursor:pointer;
      font-family:"Cinzel",serif; transition:transform .2s, box-shadow .2s;
      margin-top:.25rem;
    }
    .btn-auth:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(255,215,0,.35); }

    .auth-warning { color:#fb7185; font-size:.72rem; font-weight:600; margin-top:.6rem; display:flex; align-items:center; gap:.4rem; }

    /* Login card */
    .login-card { display:flex; flex-direction:column; justify-content:space-between; }
    .login-card-title { font-family:"Cinzel",serif; font-size:1.4rem; font-weight:700; margin-bottom:1.5rem; }
    .login-footer { margin-top:2rem; padding-top:1.2rem; border-top:1px solid #27272a; text-align:center; color:#52525b; font-size:.625rem; }

    /* ============================================================
       CHAT
       ============================================================ */
    .chat-container {
      background:rgba(10,10,15,.8); backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,.1); border-radius:20px; overflow:hidden;
    }
    .chat-message {
      padding:12px 16px; border-radius:12px; margin-bottom:8px;
      max-width:85%; word-wrap:break-word; animation:messageSlide .3s ease-out;
    }
    @keyframes messageSlide { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .chat-message.own   { background:linear-gradient(135deg,rgba(147,51,234,.3),rgba(236,72,153,.2)); margin-left:auto; border:1px solid rgba(147,51,234,.3); }
    .chat-message.other { background:rgba(255,255,255,.05); margin-right:auto; border:1px solid rgba(255,255,255,.1); }
    .chat-message.system { background:linear-gradient(135deg,rgba(255,215,0,.2),rgba(255,165,0,.1)); margin:0 auto; text-align:center; border:1px solid rgba(255,215,0,.3); font-weight:600; }
    .chat-message.gift  { background:linear-gradient(135deg,rgba(236,72,153,.3),rgba(249,115,22,.2)); margin:0 auto; text-align:center; border:1px solid rgba(236,72,153,.4); }

    /* Scrollbar */
    ::-webkit-scrollbar { width:8px; }
    ::-webkit-scrollbar-track { background:rgba(255,255,255,.05); }
    ::-webkit-scrollbar-thumb { background:linear-gradient(135deg,var(--accent-purple),var(--accent-pink)); border-radius:10px; }
    ::-webkit-scrollbar-thumb:hover { background:linear-gradient(135deg,var(--primary-gold),var(--secondary-gold)); }

    /* Admin FAB */
    .admin-fab {
      position:fixed; bottom:2rem; right:2rem; width:60px; height:60px;
      background:linear-gradient(135deg,var(--primary-gold),var(--secondary-gold));
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      cursor:pointer; z-index:1000; box-shadow:0 8px 30px rgba(255,215,0,.5);
      transition:all .3s; animation:fabPulse 2s ease-in-out infinite;
    }
    @keyframes fabPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05);box-shadow:0 12px 40px rgba(255,215,0,.7)} }
    .admin-fab:hover { transform:scale(1.1) rotate(90deg); box-shadow:0 12px 50px rgba(255,215,0,.8); }

    /* Bounty */
    .bounty-target {
      border:2px solid #ef4444!important;
      background:linear-gradient(135deg,rgba(239,68,68,.2),rgba(220,38,38,.1))!important;
      animation:bountyPulse 1.5s infinite; position:relative;
    }
    .bounty-target::after { content:"‚ö†Ô∏è WANTED"; position:absolute; top:8px; right:8px; background:#ef4444; color:#fff; padding:4px 8px; border-radius:6px; font-size:10px; font-weight:700; letter-spacing:1px; }
    @keyframes bountyPulse { 0%,100%{box-shadow:0 0 10px rgba(239,68,68,.5)} 50%{box-shadow:0 0 30px rgba(239,68,68,.8)} }

    /* Spinner / Fade */
    .spinner { border:3px solid rgba(255,255,255,.1); border-top:3px solid var(--primary-gold); border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:0 auto; }
    @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    .fade-in { animation:fadeIn .6s ease-out; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

    /* Status */
    .status-online  { width:10px;height:10px;background:#10b981;border-radius:50%;display:inline-block;animation:statusBlink 2s ease-in-out infinite;box-shadow:0 0 8px #10b981; }
    .status-offline { width:10px;height:10px;background:#6b7280;border-radius:50%;display:inline-block; }
    @keyframes statusBlink { 0%,100%{opacity:1} 50%{opacity:.5} }
    .last-online { font-size:9px; color:#9ca3af; font-weight:500; }

    /* ============================================================
       WELCOME OVERLAY
       ============================================================ */
    #welcome-overlay {
      position:fixed; inset:0; z-index:5000;
      background:rgba(0,0,0,.85); backdrop-filter:blur(8px);
      display:none;
      flex-direction:column; align-items:center; justify-content:center;
      gap:1.5rem; padding:2rem;
    }
    #welcome-overlay.show { display:flex; }
    #welcome-title { font-family:"Cinzel",serif; font-size:2.25rem; font-weight:900; text-align:center; }
    #welcome-sub { color:#9ca3af; text-align:center; max-width:28rem; font-size:.9rem; }

    /* ============================================================
       APP SCREEN
       ============================================================ */
    #app-screen { display:none; flex-direction:column; min-height:100vh; }
    #app-screen.visible { display:flex; }

    .app-header {
      position:sticky; top:0; z-index:100;
      background:rgba(10,10,15,.9); backdrop-filter:blur(24px);
      border-bottom:1px solid rgba(255,255,255,.08);
      padding:.65rem 1rem;
      display:flex; align-items:center; justify-content:space-between; gap:.75rem;
      flex-shrink:0; flex-wrap:wrap;
    }
    .header-left { display:flex; align-items:center; gap:.6rem; }
    .header-logo { font-family:"Cinzel",serif; font-size:1rem; font-weight:700; }
    .header-right { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .stat-chip {
      display:flex; align-items:center; gap:.3rem; font-size:.72rem; color:#cbd5e1;
      background:rgba(255,255,255,.06); padding:.28rem .6rem; border-radius:9999px;
      border:1px solid rgba(255,255,255,.08);
    }
    .stat-chip .label { color:#64748b; font-size:.6rem; text-transform:uppercase; letter-spacing:.05em; }
    .stat-chip .value { font-weight:700; color:#f1f5f9; }
    #logout-btn {
      font-size:.7rem; color:#71717a; border:1px solid #3f3f46;
      background:none; padding:.3rem .7rem; border-radius:.45rem;
      cursor:pointer; transition:color .2s, border-color .2s; font-family:inherit;
    }
    #logout-btn:hover { color:#fb7185; border-color:#fb7185; }

    .app-body {
      flex:1; display:grid;
      grid-template-columns:1fr 360px;
      gap:1rem; padding:1rem;
      min-height:0; overflow:hidden;
    }
    @media (max-width:860px) { .app-body { grid-template-columns:1fr; grid-template-rows:1fr 1fr; } }

    .hierarchy-panel { display:flex; flex-direction:column; min-height:0; overflow:hidden; }
    .panel-title { flex-shrink:0; margin-bottom:.5rem; font-family:"Cinzel",serif; font-size:1rem; font-weight:700; }
    #pyramid-list { flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:.5rem; padding-right:4px; }
    .loading-placeholder { text-align:center; color:#52525b; padding:3rem 0; }

    .chat-panel { display:flex; flex-direction:column; min-height:0; overflow:hidden; }
    .chat-panel .chat-container { flex:1; display:flex; flex-direction:column; min-height:0; }
    #chat-box { flex:1; overflow-y:auto; padding:.7rem; display:flex; flex-direction:column; gap:.15rem; }
    #typing-indicator { font-size:.68rem; color:#6b7280; font-style:italic; padding:.15rem .7rem; height:1.2rem; flex-shrink:0; }
    #typing-indicator.hidden { visibility:hidden; }
    .chat-input-row {
      display:flex; gap:.45rem; padding:.5rem .65rem; flex-shrink:0;
      border-top:1px solid rgba(255,255,255,.07);
    }
    .chat-input-row input {
      flex:1; min-width:0; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      border-radius:9px; padding:.5rem .7rem; color:#e2e8f0; font-size:.8rem;
      font-family:inherit; transition:border-color .2s, box-shadow .2s;
    }
    .chat-input-row input::placeholder { color:#4a5568; }
    .chat-input-row input:focus { border-color:var(--primary-gold); box-shadow:0 0 0 3px rgba(255,215,0,.1); outline:none; }
    #send-chat {
      background:linear-gradient(135deg,var(--primary-gold),var(--secondary-gold));
      border:none; color:#000; font-weight:700; font-size:.68rem;
      text-transform:uppercase; letter-spacing:.08em;
      padding:.5rem .9rem; border-radius:9px; cursor:pointer;
      transition:transform .15s, box-shadow .15s; flex-shrink:0; font-family:inherit;
    }
    #send-chat:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(255,215,0,.35); }

    /* Hidden utility (replaces Tailwind .hidden) */
    .hidden { display:none !important; }
  </style>
</head>
<body>

<div class="bg-animate"></div>

<!-- AUTH SCREEN -->
<div id="auth-screen">
  <div class="auth-grid">
    <!-- Registration -->
    <div class="glass-card auth-card fade-in">
      <h2 class="auth-card-title gradient-text">Join The Elite</h2>
      <p class="auth-card-sub">Enter the hierarchy. Prove your worth.</p>

      <div class="auth-field">
        <input id="auth-name" type="text" placeholder="Full Name" class="auth-input" autocomplete="name"/>
      </div>
      <div class="auth-field">
        <div class="auth-row">
          <select id="auth-gender" class="auth-input">
            <option value="">Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
          <input id="auth-roll" type="text" placeholder="Roll Number" class="auth-input auth-input-half"/>
        </div>
      </div>
      <div class="auth-field">
        <div class="auth-row">
          <input id="auth-class" type="text" placeholder="Class (e.g. 11)" class="auth-input"/>
          <input id="auth-sec" type="text" placeholder="Section" class="auth-input auth-input-quarter" maxlength="1"/>
        </div>
      </div>
      <div class="auth-field">
        <input id="auth-email" type="email" placeholder="Email (optional)" class="auth-input" autocomplete="email"/>
      </div>
      <div class="auth-field">
        <div class="auth-pass-wrap">
          <input id="auth-pass" type="password" placeholder="Create password (min 8 chars)" class="auth-input" autocomplete="new-password" minlength="8"/>
          <button id="toggle-pass" type="button">Show</button>
        </div>
      </div>
      <button id="register-btn" class="btn-auth">Enter The Pyramid</button>
      <div class="auth-warning">‚ö† Use your real name and roll number. Duplicates blocked.</div>
    </div>

    <!-- Login -->
    <div class="glass-card auth-card fade-in">
      <div class="login-card">
        <div>
          <h3 class="login-card-title gradient-text-purple">Secure Access</h3>
          <div class="auth-field">
            <input id="login-name" type="text" placeholder="Full Name" class="auth-input" autocomplete="username"/>
          </div>
          <div class="auth-field">
            <input id="login-pass" type="password" placeholder="Password" class="auth-input" autocomplete="current-password"/>
          </div>
          <button id="login-btn" class="btn-auth">Login</button>
        </div>
        <div class="login-footer">By entering you agree to maintain dignity and respect within the hierarchy.</div>
      </div>
    </div>
  </div>
</div>

<!-- WELCOME OVERLAY -->
<div id="welcome-overlay">
  <h1 id="welcome-title" class="gradient-text">Welcome</h1>
  <p id="welcome-sub">Your hierarchy awaits</p>
  <button id="welcome-proceed" class="btn-primary">Enter The Pyramid</button>
</div>

<!-- APP SCREEN -->
<div id="app-screen" class="hidden">
  <header class="app-header">
    <div class="header-left">
      <span class="header-logo gradient-text">‚¨• The Pyramid</span>
    </div>
    <div class="header-right">
      <div class="stat-chip"><span class="label">You</span><span class="value" id="my-name-display">‚Äî</span></div>
      <div class="stat-chip"><span class="label">Title</span><span class="value" id="my-title-display">Commoner</span></div>
      <div class="stat-chip"><span class="label">Credits</span><span class="value" id="my-credits-display">0</span></div>
      <div class="stat-chip"><span class="label">Votes</span><span class="value" id="votes-remaining-display">3</span></div>
      <button id="logout-btn">Logout</button>
    </div>
  </header>
  <div class="app-body">
    <div class="hierarchy-panel">
      <h2 class="panel-title gradient-text">üëë Hierarchy</h2>
      <div id="pyramid-list">
        <div class="loading-placeholder"><div class="spinner"></div><br/>Loading hierarchy‚Ä¶</div>
      </div>
    </div>
    <div class="chat-panel">
      <h2 class="panel-title gradient-text">üí¨ Chat</h2>
      <div class="chat-container">
        <div id="chat-box"></div>
        <div id="typing-indicator" class="hidden"></div>
        <div class="chat-input-row">
          <input id="chat-input" type="text" placeholder="Type a message‚Ä¶" autocomplete="off"/>
          <button id="send-chat">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Admin FAB -->
<div id="admin-fab" class="admin-fab hidden" onclick="openAdminPower()">
  <span style="font-size:1.6rem">üëë</span>
</div>

<!-- Bridge: auth.js removes .hidden ‚Üí we add .visible so #app-screen displays -->
<script> document.addEventListener('DOMContentLoaded', () => {
    const authScreen = document.getElementById('auth-screen');
    const appScreen = document.getElementById('app-screen');

    // Listen for the 'authReady' event from our fixed auth.js
    window.addEventListener('authSuccess', (e) => {
        const user = e.detail.user;
        
        // 1. Switch Screens
        authScreen.style.display = 'none';
        appScreen.style.display = 'block';
        appScreen.classList.remove('hidden');
        appScreen.classList.add('visible');

        // 2. Initialize Sub-Systems (Retaining all features)
        if (typeof initEconomy === 'function') initEconomy(user);
        if (typeof initChat === 'function') initChat(user);
        if (typeof initBounty === 'function') initBounty(user);
        
        // 3. Admin Check
        db.collection('users').doc(user.uid).get().then(doc => {
            if (doc.exists && doc.data().role === 'admin') {
                document.getElementById('admin-fab').style.display = 'flex';
            }
        });
    });
});
  <script>

<!-- Scripts -->
<script src="admin.js"></script>
<script src="auth.js"></script>
<script src="bounty.js"></script>
<script src="chat.js"></script>
<script src="economy.js"></script>
<script src="hierarchy-gift-buttons.js"></script>
<script src="voting.js">
  
</script> <script>
window.addEventListener('load', () => {
    const authScreen = document.getElementById('auth-screen');
    const appScreen = document.getElementById('app-screen');

    auth.onAuthStateChanged(user => {
        if (user) {
            console.log("Sovereign Verified:", user.email);
            
            // Fix the Blank Screen
            authScreen.style.display = 'none';
            appScreen.style.display = 'block';
            appScreen.classList.remove('hidden');
            
            // TRICK: Only run feature setups if they exist in your files
            if (typeof initEconomy === 'function') initEconomy();
            if (typeof setupVoting === 'function') setupVoting();
            if (typeof loadChat === 'function') loadChat();
            
            // Admin Protection
            db.collection('users').doc(user.uid).get().then(doc => {
                if(doc.exists && doc.data().role === 'admin') {
                    document.getElementById('admin-fab').style.display = 'flex';
                }
            });
        } else {
            authScreen.style.display = 'flex';
            appScreen.style.display = 'none';
        }
    });
});
</script>
</body>
</html>
